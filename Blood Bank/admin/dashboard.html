<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>অ্যাডমিন ড্যাশবোর্ড - স্বপ্নের ফরিদগঞ্জ</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #e63946;
            --secondary: #1d3557;
            --light: #f1faee;
            --dark: #0f172a;
        }

        body {
            margin: 0;
            font-family: 'Hind Siliguri', sans-serif;
            background: #f8f9fa;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--secondary);
            color: white;
            height: 100vh;
            position: fixed;
            padding: 1rem;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 2rem;
            display: block;
            text-align: center;
            color: white;
            text-decoration: none;
        }

        .nav-link {
            display: block;
            padding: 10px 15px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            margin-bottom: 5px;
            border-radius: 5px;
            transition: 0.3s;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .logout-btn {
            position: absolute;
            bottom: 2rem;
            left: 1rem;
            right: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            width: calc(100% - 2rem);
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 2rem;
            width: calc(100% - 250px);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        h1 {
            color: var(--secondary);
            margin: 0;
        }

        /* Table */
        .card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th,
        td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            color: var(--secondary);
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            color: white;
            font-size: 0.8rem;
            margin-right: 5px;
        }

        .edit-btn {
            background: #457b9d;
        }

        .delete-btn {
            background: #e63946;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            width: 500px;
            border-radius: 10px;
            position: relative;
            max-height: 80vh;
            /* Limit height to 80% of viewport */
            overflow-y: auto;
            /* Enable vertical scrolling */
        }

        /* Custom Scrollbar for Modal */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }


        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .add-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="sidebar">
        <a href="#" class="brand">স্বপ্নের ফরিদগঞ্জ</a>
        <a href="#" class="nav-link active"><i class="fas fa-tint"></i> ব্লাড ডোনার</a>
        <button class="logout-btn" onclick="logout()">লগ আউট</button>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>ব্লাড ডোনার তালিকা</h1>
            <button class="add-btn" onclick="openModal()">+ নতুন দাতা যুক্ত করুন</button>
        </div>

        <div class="card">
            <table id="donorTable">
                <thead>
                    <tr>
                        <th>নাম</th>
                        <th>গ্রুপ</th>
                        <th>ফোন</th>
                        <th>এলাকা</th>
                        <th>অ্যাকশন</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal -->
    <div id="donorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">নতুন দাতা যুক্ত করুন</h2>
            <form id="donorForm">
                <input type="hidden" id="donorId">
                <div class="form-group">
                    <label>নাম</label>
                    <input type="text" id="name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>রক্তের গ্রুপ</label>
                    <select id="group" class="form-control" required>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ফোন</label>
                    <input type="text" id="phone" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>জেলা</label>
                    <select id="zila" class="form-control" onchange="updateUpazilas()" required>
                        <option value="">জেলা নির্বাচন করুন</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>উপজেলা</label>
                    <select id="upazila" class="form-control" required>
                        <option value="">প্রথমে জেলা নির্বাচন করুন</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>শেষ দান</label>
                    <input type="text" id="lastDonation" class="form-control" placeholder="যেমন: 23/11/2025">
                </div>
                <div class="form-group">
                    <label>ফেসবুক প্রোফাইল লিংক (ঐচ্ছিক)</label>
                    <input type="url" id="facebookUrl" class="form-control" placeholder="https://facebook.com/username">
                </div>
                <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="whatsapp" style="width: auto;">
                    <label for="whatsapp" style="margin: 0; cursor: pointer;">হোয়াটসঅ্যাপ (WhatsApp) আছে</label>
                </div>

                <button type="submit" class="add-btn" style="width: 100%;">সংরক্ষণ করুন</button>
            </form>
        </div>
    </div>

    <script>
        const API_URL = 'https://sopner-faridganj-api.vercel.app/api/blood-bank/donors';
        const token = localStorage.getItem('adminToken');

        if (!token) {
            window.location.href = 'index.html';
        }

        async function fetchDonors() {
            const res = await fetch(API_URL);
            const data = await res.json();
            const tbody = document.querySelector('#donorTable tbody');
            tbody.innerHTML = '';

            data.forEach(donor => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${donor.name}</td>
                    <td><span style="background: #ffebee; color: #e63946; padding: 2px 8px; border-radius: 10px; font-weight: bold;">${donor.group}</span></td>
                    <td>${donor.phone}</td>
                    <td>${donor.upazila}, ${donor.zila}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick='editDonor(${JSON.stringify(donor)})'><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" onclick="deleteDonor(${donor.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        const districtMapping = {
            "Dhaka": "ঢাকা", "Chittagong": "চট্টগ্রাম", "Rajshahi": "রাজশাহী", "Khulna": "খুলনা", "Barisal": "বরিশাল",
            "Sylhet": "সিলেট", "Rangpur": "রংপুর", "Mymensingh": "ময়মনসিংহ", "Comilla": "কুমিল্লা", "Chandpur": "চাঁদপুর",
            "Feni": "ফেনী", "Noakhali": "নোয়াখালী", "Lakshmipur": "লক্ষ্মীপুর", "Brahmanbaria": "ব্রাহ্মণবাড়িয়া",
            "Cox's Bazar": "কক্সবাজার", "Rangamati": "রাঙ্গামাটি", "Bandarban": "বান্দরবান", "Khagrachari": "খাগড়াছড়ি",
            "Gazipur": "গাজীপুর", "Narayanganj": "নারায়ণগঞ্জ", "Tangail": "টাঙ্গাইল", "Kishoreganj": "কিশোরগঞ্জ",
            "Manikganj": "মানিকগঞ্জ", "Munshiganj": "মুন্সিগঞ্জ", "Narsingdi": "নরসিংদী", "Faridpur": "ফরিদপুর",
            "Gopalganj": "গোপালগঞ্জ", "Madaripur": "মাদারীপুর", "Rajbari": "রাজবাড়ী", "Shariatpur": "শরীয়তপুর",
            "Bogra": "বগুড়া", "Joypurhat": "জয়পুরহাট", "Naogaon": "নওগাঁ", "Natore": "নাটোর", "Chapainawabganj": "চাঁপাইনবাবগঞ্জ",
            "Pabna": "পাবনা", "Sirajganj": "সিরাজগঞ্জ", "Dinajpur": "দিনাজপুর", "Gaibandha": "গাইবান্ধা", "Kurigram": "কুড়িগ্রাম",
            "Lalmonirhat": "লালমনিরহাট", "Nilphamari": "নীলফামারী", "Panchagarh": "পঞ্চগড়", "Thakurgaon": "ঠাকুরগাঁও",
            "Bagerhat": "বাগেরহাট", "Chuadanga": "চুয়াডাঙ্গা", "Jessore": "যশোর", "Jhenaidah": "ঝিনাইদহ", "Kushtia": "কুষ্টিয়া",
            "Magura": "মাগুরা", "Meherpur": "মেহেরপুর", "Narail": "নড়াইল", "Satkhira": "সাতক্ষীরা", "Barguna": "বরগুনা",
            "Bhola": "ভোলা", "Jhalokati": "ঝালকাঠি", "Patuakhali": "পটুয়াখালী", "Pirojpur": "পিরোজপুর", "Habiganj": "হবিগঞ্জ",
            "Moulvibazar": "মৌলভীবাজার", "Sunamganj": "সুনামগঞ্জ", "Jamalpur": "জামালপুর", "Netrokona": "নেত্রকোনা", "Sherpur": "শেরপুর"
        };

        const upazilaData = {
            "Chandpur": ["চাঁদপুর সদর", "ফরিদগঞ্জ", "হাইমচর", "কচুয়া", "মতলব উত্তর", "মতলব দক্ষিণ", "শাহরাস্তি", "হাজীগঞ্জ"],
            "Dhaka": ["ধামরাই", "দোহার", "কেরানীগঞ্জ", "নবাবগঞ্জ", "সাভার"],
            "Comilla": ["কুমিল্লা সদর", "বরুড়া", "ব্রাহ্মণপাড়া", "বুড়িচং", "চান্দিনা", "চৌদ্দগ্রাম", "দাউদকান্দি", "দেবিদ্বার", "হোমনা", "লাকসাম", "মুরাদনগর", "নাঙ্গলকোট", "মেঘনা", "তিতাস", "মনোহরগঞ্জ", "সদর দক্ষিণ"],
            "Chittagong": ["চট্টগ্রাম সদর", "আনোয়ারা", "বাঁশখালী", "বোয়ালখালী", "চন্দনাইশ", "ফটিকছড়ি", "হাটহাজারী", "লোহাগাড়া", "মীরসরাই", "পটিয়া", "রাঙ্গুনিয়া", "রাউজান", "সন্দ্বীপ", "সাতকানিয়া", "সীতাকুণ্ড", "কর্ণফুলী"],
            "Feni": ["ফেনী সদর", "ছাগলনাইয়া", "দাগনভূঞা", "পরশুরাম", "সোনাগাজী", "ফুলগাজী"],
            "Noakhali": ["নোয়াখালী সদর", "বেগমগঞ্জ", "চাটখিল", "কোম্পানীগঞ্জ", "হাতিয়া", "সেনবাগ", "সোনাইমুড়ী", "সুবর্ণচর", "কবিরহাট"],
            "Lakshmipur": ["লক্ষ্মীপুর সদর", "কমলনগর", "রায়পুর", "রামগঞ্জ", "রামগতি"],
            "Brahmanbaria": ["ব্রাহ্মণবাড়িয়া সদর", "আখাউড়া", "কসবা", "নাসিরনগর", "নবীনগর", "সরাইল", "আশুগঞ্জ", "বাঞ্ছারামপুর", "বিজয়নগর"],
            "Gazipur": ["গাজীপুর সদর", "কালিয়াকৈর", "কালীগঞ্জ", "কাপাসিয়া", "শ্রীপুর"],
            "Narayanganj": ["নারায়ণগঞ্জ সদর", "আড়াইহাজার", "বন্দর", "রূপগঞ্জ", "সোনারগাঁও"],
            "Tangail": ["টাঙ্গাইল সদর", "বাসাইল", "ভুয়াপুর", "দেলদুয়ার", "ঘাটাইল", "গোপালপুর", "কালিহাতী", "মধুপুর", "মির্জাপুর", "নাগরপুর", "সখিপুর", "ধনবাড়ী"],
            "Kishoreganj": ["কিশোরগঞ্জ সদর", "অষ্টগ্রাম", "বাজিতপুর", "ভৈরব", "হোসেনপুর", "ইটনা", "করিমগঞ্জ", "কটিয়াদী", "কুলিয়ারচর", "মিঠামইন", "নিকলী", "পাকুন্দিয়া", "তাড়াইল"],
            "Manikganj": ["মানিকগঞ্জ সদর", "দৌলতপুর", "ঘিওর", "হরিরামপুর", "সাটুরিয়া", "শিবালয়", "সিংগাইর"],
            "Munshiganj": ["মুন্সিগঞ্জ সদর", "গজারিয়া", "লৌহজং", "সিরাজদিখান", "শ্রীনগর", "টংগীবাড়ী"],
            "Narsingdi": ["নরসিংদী সদর", "বেলাবো", "মনোহরদী", "পলাশ", "রায়পুরা", "শিবপুর"],
            "Rajshahi": ["রাজশাহী সদর", "বাঘা", "বাগমারা", "চারঘাট", "দুর্গাপুর", "গোদাগাড়ী", "মোহনপুর", "পবা", "পুঠিয়া", "তানোর"],
            "Bogra": ["বগুড়া সদর", "আদমদিঘী", "দুপচাঁচিয়া", "গাবতলী", "কাহালু", "নন্দীগ্রাম", "সারিয়াকান্দি", "শাজাহানপুর", "শেরপুর", "শিবগঞ্জ", "সোনাতলা", "ধুনট"],
            "Khulna": ["খুলনা সদর", "বটিয়াঘাটা", "দাকোপ", "ডুমুরিয়া", "দিঘলিয়া", "কয়রা", "পাইকগাছা", "ফুলতলা", "রূপসা", "তেরখাদা"],
            "Barisal": ["বরিশাল সদর", "আগৈলঝাড়া", "বাবুগঞ্জ", "বাকেরগঞ্জ", "বানারীপাড়া", "গৌরনদী", "হিজলা", "মেহেন্দিগঞ্জ", "মুলাদী", "উজিরপুর"],
            "Sylhet": ["সিলেট সদর", "বালাগঞ্জ", "বিয়ানীবাজার", "বিশ্বনাথ", "কোম্পানীগঞ্জ", "ফেঞ্চুগঞ্জ", "গোলাপগঞ্জ", "গোয়াইনঘাট", "জৈন্তাপুর", "কানাইঘাট", "জকিগঞ্জ", "দক্ষিণ সুরমা"],
            "Rangpur": ["রংপুর সদর", "বদরগঞ্জ", "গংগাচড়া", "কাউনিয়া", "মিঠাপুকুর", "পীরগঞ্জ", "পীরগাছা", "তারাগঞ্জ"],
            "Mymensingh": ["ময়মনসিংহ সদর", "ভালুকা", "ফুলবাড়ীয়া", "গফরগাঁও", "গৌরীপুর", "হালুয়াঘাট", "ঈশ্বরগঞ্জ", "মুক্তাগাছা", "নান্দাইল", "ফুলপুর", "ত্রিশাল", "ধোবাউড়া", "তারাকান্দা"],
            "Faridpur": ["ফরিদপুর সদর", "আলফাডাঙ্গা", "ভাঙ্গা", "বোয়ালমারী", "চরভদ্রাসন", "মধুখালী", "নগরকান্দা", "সদরপুর", "সালথা"],
            "Gopalganj": ["গোপালগঞ্জ সদর", "কাশিয়ানী", "কোটালীপাড়া", "মুকসুদপুর", "টুংগীপাড়া"],
            "Madaripur": ["মাদারীপুর সদর", "কালকিনি", "রাজৈর", "শিবচর"],
            "Rajbari": ["রাজবাড়ী সদর", "বালিয়াকান্দি", "গোয়ালন্দ", "কালুখালী", "পাংশা"],
            "Shariatpur": ["শরীয়তপুর সদর", "ডামুড্যা", "গোসাইরহাট", "নড়িয়া", "জাজিরা", "ভেদরগঞ্জ"],
            "Joypurhat": ["জয়পুরহাট সদর", "আক্কেলপুর", "কালাই", "খেতলাল", "পাঁচবিবি"],
            "Naogaon": ["নওগাঁ সদর", "আত্রাই", "বদলগাছী", "মান্দা", "ধামইরহাট", "মহাদেবপুর", "নিয়ামতপুর", "পত্নীতলা", "পোরশা", "রাণীনগর", "সাপাহার"],
            "Natore": ["নাটোর সদর", "বাগাতিপাড়া", "বড়াইগ্রাম", "গুরুদাসপুর", "লালপুর", "নলডাঙ্গা", "সিংড়া"],
            "Chapainawabganj": ["চাঁপাইনবাবগঞ্জ সদর", "ভোলাহাট", "গোমস্তাপুর", "নাচোল", "শিবগঞ্জ"],
            "Pabna": ["পাবনা সদর", "আটঘরিয়া", "ভাঙ্গুড়া", "চাটমোহর", "ফরিদপুর", "ঈশ্বরদী", "সাঁথিয়া", "সুজানগর", "বেড়া"],
            "Sirajganj": ["সিরাজগঞ্জ সদর", "বেলকুচি", "চৌহালী", "কামারখন্দ", "কাজিপুর", "রায়গঞ্জ", "শাহজাদপুর", "তাড়াশ", "উল্লাপাড়া"],
            "Dinajpur": ["দিনাজপুর সদর", "বীরগঞ্জ", "বিরামপুর", "বোচাগঞ্জ", "চিরিরবন্দর", "ফুলবাড়ী", "ঘোড়াঘাট", "হাকিমপুর", "কাহারোল", "খানসামা", "নবাবগঞ্জ", "পার্বতীপুর", "বিরল"],
            "Gaibandha": ["গাইবান্ধা সদর", "ফুলছড়ি", "গোবিন্দগঞ্জ", "পলাশবাড়ী", "সাদুল্লাপুর", "সাঘাটা", "সুন্দরগঞ্জ"],
            "Kurigram": ["কুড়িগ্রাম সদর", "ভুরুঙ্গামারী", "চর রাজিবপুর", "চিলমারী", "ফুলবাড়ী", "নাগেশ্বরী", "রাজারহাট", "রৌমারী", "উলিপুর"],
            "Lalmonirhat": ["লালমনিরহাট সদর", "আদিতমারী", "কালীগঞ্জ", "হাতীবান্ধা", "পাটগ্রাম"],
            "Nilphamari": ["নীলফামারী সদর", "ডোমার", "ডিমলা", "জলঢাকা", "কিশোরগঞ্জ", "সৈয়দপুর"],
            "Panchagarh": ["পঞ্চগড় সদর", "আটোয়ারী", "বোদা", "দেবীগঞ্জ", "তেঁতুলিয়া"],
            "Thakurgaon": ["ঠাকুরগাঁও সদর", "বালিয়াডাঙ্গী", "হরিপুর", "পীরগঞ্জ", "রাণীশংকৈল"],
            "Bagerhat": ["বাগেরহাট সদর", "চিতলমারী", "ফকিরহাট", "কচুয়া", "মোল্লাহাট", "মোংলা", "মোড়েলগঞ্জ", "রামপাল", "শরণখোলা"],
            "Chuadanga": ["চুয়াডাঙ্গা সদর", "আলমডাঙ্গা", "দামুড়হুদা", "জীবননগর"],
            "Jessore": ["যশোর সদর", "অভয়নগর", "বাঘারপাড়া", "চৌগাছা", "ঝিকরগাছা", "কেশবপুর", "মণিরামপুর", "শার্শা"],
            "Jhenaidah": ["ঝিনাইদহ সদর", "হরিণাকুন্ডু", "কালীগঞ্জ", "কোটচাঁদপুর", "মহেশপুর", "শৈলকুপা"],
            "Kushtia": ["কুষ্টিয়া সদর", "ভেড়ামারা", "দৌলতপুর", "খোকসা", "কুমারখালী", "মিরপুর"],
            "Magura": ["মাগুরা সদর", "মহম্মদপুর", "শালিখা", "শ্রীপুর"],
            "Meherpur": ["মেহেরপুর সদর", "গাংনী", "মুজিবনগর"],
            "Narail": ["নড়াইল সদর", "কালিয়া", "লোহাগড়া"],
            "Satkhira": ["সাতক্ষীরা সদর", "আশাশুনি", "দেবহাটা", "কলারোয়া", "কালীগঞ্জ", "শ্যামনগর", "তালা"],
            "Barguna": ["বরগুনা সদর", "আমতলী", "বামনা", "বেতাগী", "পাথরঘাটা", "তালতলী"],
            "Bhola": ["ভোলা সদর", "বোরহানউদ্দিন", "চরফ্যাশন", "দৌলতখান", "লালমোহন", "মনপুরা", "তজুমদ্দিন"],
            "Jhalokati": ["ঝালকাঠি সদর", "কাঠালিয়া", "নলছিটি", "রাজাপুর"],
            "Patuakhali": ["পটুয়াখালী সদর", "বাউফল", "দশমিনা", "গলাচিপা", "কলাপাড়া", "মির্জাগঞ্জ", "দুমকি", "রাঙ্গাবালী"],
            "Pirojpur": ["পিরোজপুর সদর", "ভান্ডারিয়া", "কাউখালী", "মঠবাড়ীয়া", "নাজিরপুর", "নেছারাবাদ", "ইন্দুরকানী"],
            "Habiganj": ["হবিগঞ্জ সদর", "বাহুবল", "বানিয়াচং", "চুনারুঘাট", "লাখাই", "মাধবপুর", "নবীগঞ্জ", "শায়েস্তাগঞ্জ"],
            "Moulvibazar": ["মৌলভীবাজার সদর", "বড়লেখা", "জুড়ী", "কমলগঞ্জ", "কুলাউড়া", "রাজনগর", "শ্রীমঙ্গল"],
            "Sunamganj": ["সুনামগঞ্জ সদর", "বিশ্বম্ভরপুর", "ছাতক", "দিরাই", "ধর্মপাশা", "দোয়ারাবাজার", "জগন্নাথপুর", "জামালগঞ্জ", "শাল্লা", "তাহিরপুর", "দক্ষিণ সুনামগঞ্জ"],
            "Jamalpur": ["জামালপুর সদর", "বকশীগঞ্জ", "দেওয়ানগঞ্জ", "ইসলামপুর", "মাদারগঞ্জ", "মেলান্দহ", "সরিষাবাড়ী"],
            "Netrokona": ["নেত্রকোনা সদর", "আটপাড়া", "বারহাট্টা", "দুর্গাপুর", "খালিয়াজুরী", "কলমাকান্দা", "কেন্দুয়া", "মদন", "মোহনগঞ্জ", "পূর্বধলা"],
            "Sherpur": ["শেরপুর সদর", "ঝিনাইগাতী", "নালিতাবাড়ী", "নকলা", "শ্রীবরদী"],
            "Cox's Bazar": ["কক্সবাজার সদর", "চকরিয়া", "কুতুবদিয়া", "মহেশখালী", "পেকুয়া", "রামু", "টেকনাফ", "উখিয়া"],
            "Rangamati": ["রাঙ্গামাটি সদর", "বাঘাইছড়ি", "বরকল", "বিলাইছড়ি", "কাপ্তাই", "কাউখালী", "জুরাছড়ি", "লংগদু", "নানিয়ারচর", "রাজস্থলী"],
            "Bandarban": ["বান্দরবান সদর", "আলীকদম", "লামা", "নাইক্ষ্যংছড়ি", "রোয়াংছড়ি", "রুমা", "থানচি"],
            "Khagrachari": ["খাগড়াছড়ি সদর", "দিঘীনালা", "লক্ষ্মীছড়ি", "মহালছড়ি", "মানিকছড়ি", "মাটিরাঙ্গা", "পানছড়ি", "রামগড়", "গুইমারা"]
        };

        function populateZilas() {
            const zilaSelect = document.getElementById('zila');
            // Store keys alphabetically for better UX? Or just standard order.
            const zilas = Object.keys(upazilaData).sort();

            zilas.forEach(zilaEng => {
                const option = document.createElement('option');
                option.value = zilaEng;
                // Show Bangla name if available, else English
                option.textContent = districtMapping[zilaEng] || zilaEng;
                zilaSelect.appendChild(option);
            });
        }

        function updateUpazilas() {
            const zilaSelect = document.getElementById('zila');
            const upazilaSelect = document.getElementById('upazila');
            const selectedZila = zilaSelect.value;

            upazilaSelect.innerHTML = '<option value="">উপজেলা নির্বাচন করুন</option>';

            if (selectedZila && upazilaData[selectedZila]) {
                upazilaData[selectedZila].forEach(upazila => {
                    const option = document.createElement('option');
                    option.value = upazila;
                    option.textContent = upazila;
                    upazilaSelect.appendChild(option);
                });
            }
        }

        function editDonor(donor) {
            document.getElementById('modalTitle').innerText = 'দাতা তথ্য হালনাগাদ করুন';
            document.getElementById('donorId').value = donor.id;
            document.getElementById('name').value = donor.name;
            document.getElementById('group').value = donor.group;
            document.getElementById('phone').value = donor.phone;
            document.getElementById('lastDonation').value = donor.lastDonation || '';

            // Set District first
            const zilaSelect = document.getElementById('zila');
            zilaSelect.value = donor.zila;

            // Trigger update to populate Upazilas
            updateUpazilas();

            // Then Set Upazila
            document.getElementById('upazila').value = donor.upazila;

            // Set Facebook & WhatsApp
            document.getElementById('facebookUrl').value = donor.facebookUrl || '';
            const methods = donor.contactMethods || "";
            document.getElementById('whatsapp').checked = methods.toLowerCase().includes('whatsapp');

            openModal();

        }

        // Initialize Zila dropdown on load
        populateZilas();



        async function saveDonor(e) {
            e.preventDefault();
            const id = document.getElementById('donorId').value;
            const method = id ? 'PUT' : 'POST';
            const url = id ? `${API_URL}/${id}` : API_URL;

            let contactMethods = "Call";
            if (document.getElementById('whatsapp').checked) {
                contactMethods += ", Whatsapp";
            }

            const data = {
                name: document.getElementById('name').value,
                group: document.getElementById('group').value,
                phone: document.getElementById('phone').value,
                zila: document.getElementById('zila').value,
                upazila: document.getElementById('upazila').value,
                lastDonation: document.getElementById('lastDonation').value,
                contactMethods: contactMethods,
                facebookUrl: document.getElementById('facebookUrl').value
            };


            try {
                const res = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });

                if (res.ok) {
                    closeModal();
                    fetchDonors();
                    alert('সফলভাবে সংরক্ষিত হয়েছে!');
                } else {
                    alert('ত্রুটি হয়েছে');
                }
            } catch (err) {
                console.error(err);
                alert('সার্ভার এরর');
            }
        }

        async function deleteDonor(id) {
            if (!confirm('আপনি কি নিশ্চিত যে আপনি এই দাতা মুছে ফেলতে চান?')) return;

            try {
                const res = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (res.ok) {
                    fetchDonors();
                } else {
                    alert('মুছে ফেলা যায়নি');
                }
            } catch (err) {
                console.error(err);
            }
        }

        function logout() {
            localStorage.removeItem('adminToken');
            window.location.href = 'index.html';
        }

        // Modal Logic
        const modal = document.getElementById('donorModal');
        function openModal() { modal.style.display = 'block'; }
        function closeModal() {
            modal.style.display = 'none';
            document.getElementById('donorForm').reset();
            document.getElementById('donorId').value = '';
            document.getElementById('modalTitle').innerText = 'নতুন দাতা যুক্ত করুন';

            // Reset Dropdowns
            document.getElementById('zila').value = '';
            document.getElementById('upazila').innerHTML = '<option value="">প্রথমে জেলা নির্বাচন করুন</option>';
        }
        window.onclick = function (event) { if (event.target == modal) closeModal(); }

        document.getElementById('donorForm').addEventListener('submit', saveDonor);

        // Initial Load
        fetchDonors();
    </script>
</body>

</html>